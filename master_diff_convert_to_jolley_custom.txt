diff --git a/convert_to_jolley_custom.py b/convert_to_jolley_custom.py
index ee0684e..81b98ca 100644
--- a/convert_to_jolley_custom.py
+++ b/convert_to_jolley_custom.py
@@ -49,7 +49,10 @@ def edi_convert(edi_process, output_filename, settings_dict, parameters_dict, up
 
             # build header
 
-            header_a_record = utils.capture_records(work_file_lined[0])
+            if len(work_file_lined) > 0:
+                header_a_record = utils.capture_records(work_file_lined[0])
+            else:
+                header_a_record = None
 
             header_fields = query_object.run_arbitrary_query(
                 f"""
@@ -92,7 +95,7 @@ def edi_convert(edi_process, output_filename, settings_dict, parameters_dict, up
                 ON dsabrep_corp.ababnb = cvgrrep_corp.grabnb
             LEFT outer JOIN dacdata.dsadrep dsadrep_corp
                 ON dsabrep_corp.abajcd = dsadrep_corp.adaecd
-        WHERE ohhst.bthhnb = {header_a_record['invoice_number'].lstrip("0")}
+        WHERE ohhst.bthhnb = {header_a_record['invoice_number'].lstrip("0") if header_a_record else "0"}
             """
             )
 
@@ -126,7 +129,10 @@ def edi_convert(edi_process, output_filename, settings_dict, parameters_dict, up
             ]
 
             if len(header_fields) == 0:
-                raise CustomerLookupError(f"Cannot Find Order {header_a_record['invoice_number']} In History.")
+                if header_a_record:
+                    raise CustomerLookupError(f"Cannot Find Order {header_a_record['invoice_number']} In History.")
+                else:
+                    raise CustomerLookupError("Cannot Find Order - No header record")
             header_fields_dict = dict(zip(header_fields_list, header_fields[0]))
             if header_fields_dict["Corporate_Customer_Number"] is None:
                 header_fields_dict["Corporate_Customer_Number"] = header_fields_dict['Customer_Number']
@@ -145,7 +151,7 @@ def edi_convert(edi_process, output_filename, settings_dict, parameters_dict, up
                 [
                     prettify_dates(header_fields_dict["Invoice_Date"]),
                     header_fields_dict["Terms_Code"],
-                    header_a_record["invoice_number"],
+                    header_a_record["invoice_number"] if header_a_record else "0",
                     prettify_dates(header_fields_dict["Invoice_Date"], header_fields_dict['Terms_Duration'], -1),
                 ]
             )
@@ -179,15 +185,18 @@ def edi_convert(edi_process, output_filename, settings_dict, parameters_dict, up
 
             uom_lookup_list = query_object.run_arbitrary_query(f"""
             select distinct bubacd as itemno, bus3qt as uom_mult, buhxtx as uom_code from dacdata.odhst odhst
-            where odhst.buhhnb = {header_a_record['invoice_number']}
+            where odhst.buhhnb = {header_a_record['invoice_number'] if header_a_record else "0"}
             """)
 
             def get_uom(item_number, packsize):
                 stage_1_list = []
                 stage_2_list = []
                 for entry in uom_lookup_list:
-                    if int(entry[0]) == int(item_number):
-                        stage_1_list.append(entry)
+                    try:
+                        if int(entry[0]) == int(item_number):
+                            stage_1_list.append(entry)
+                    except ValueError:
+                        print("cannot parse item_number")
                 for entry in stage_1_list:
                     try:
                         if int(entry[1]) == int(packsize):
@@ -260,5 +269,6 @@ def edi_convert(edi_process, output_filename, settings_dict, parameters_dict, up
                             "$"+str(convert_to_price(input_edi_dict['amount'])),
                             "$"+str(convert_to_price(input_edi_dict['amount']))
                         ])
-            csv_file.writerow(["","","","","Total:","$"+str(convert_to_price(header_a_record['invoice_total']).lstrip("0"))])
+            if header_a_record:
+                csv_file.writerow(["","","","","Total:","$"+str(convert_to_price(header_a_record['invoice_total']).lstrip("0"))])
     return(output_filename + ".csv")
